# 分镜编辑界面重构计划

根据您的需求，我将对 `shots/shot{id}` 界面进行交互与布局重构，主要包含以下内容：

## 1. 步骤化流程可视化 (Step Process Bar)

**文件**: `src/views/storyboard/ShotDetailView.vue`

*   **新增状态**: `currentStep` (1: 镜头信息, 2: 分镜图片, 3: 分镜视频)。
*   **计算属性**:
    *   `isStep1Completed`: 检查镜头信息是否已保存（可通过 `currentShot.updatedAt` 或新增字段判断，此处暂定为 `saveShotBasicInfo` 成功后更新本地状态）。
    *   `isStep2Completed`: 检查是否已有生成的图片 (`currentShot.images.some(i => i.type === 'image')`)。
    *   `stepText`: 动态提示文案。
*   **布局**: 在标题栏下方新增步骤条容器。
    *   高度 48px，背景色 `#F5F7FA`。
    *   包含 3 个节点，状态分别为 `wait` (置灰), `process` (蓝色), `finish` (绿色)。
*   **逻辑**:
    *   步骤 1 完成 -> 解锁步骤 2 (遮罩消失)。
    *   步骤 2 完成 -> 解锁步骤 3 (遮罩消失)。

## 2. 移除全局标题栏按钮

**文件**: `src/views/storyboard/ShotDetailView.vue`

*   **移除**: 删除 Header 中的“保存”、“重新生成”、“通过”、“驳回”四个按钮及其相关逻辑。

## 3. 镜头信息模块重构

**文件**: `src/views/storyboard/ShotDetailView.vue`

*   **Header Actions**: 在“镜头信息”卡片 Header 右侧新增按钮组。
    *   **保存**: 图标 `Check`，调用 `saveShotBasicInfo`。成功后更新步骤状态。
    *   **重新生成**: 图标 `Refresh`，点击弹出 `ElMessageBox.confirm`，确认后调用 `regenerateShotInfo`。
*   **API 模拟**:
    *   `saveShotBasicInfo`: 模拟 API 调用，成功后 `currentStep` 设为 2。
    *   `regenerateShotInfo`: 模拟清空描述并重新生成。

## 4. 分镜图片生成模块重构

**文件**: `src/views/storyboard/ShotDetailView.vue`

*   **遮罩**: 根据 `currentStep < 2` 显示遮罩。
*   **Header Actions**: 新增“生成”按钮。
    *   图标 `VideoPause` (旋转 90度 -> CSS transform)。
    *   校验: `if (currentStep < 2) return ElMessage.warning(...)`。
    *   调用: `generateStoryboardImages` (模拟)，loading 状态，成功后展示图片。

## 5. 分镜视频生成模块重构

**文件**: `src/views/storyboard/ShotDetailView.vue`

*   **遮罩**: 根据 `currentStep < 3` 显示遮罩。
*   **Header Actions**: 新增“生成”按钮。
    *   图标 `VideoCamera`。
    *   校验: `if (currentStep < 3) return ElMessage.warning(...)`。
    *   调用: `generateStoryboardVideo` (模拟)，Websocket 进度模拟。
*   **移除**: 删除旧的“生成视频”按钮（位于预览区底部）。
*   **重试**: 视频生成成功后，右下角显示“重新生成”文本按钮。

## 6. 单元测试 (Jest)

**文件**: `src/views/storyboard/__tests__/ShotDetailView.spec.ts` (新建)

*   测试步骤节点状态计算。
*   测试按钮权限与显隐。
*   测试 API 异常重试逻辑 (Mock)。

我将按照此计划执行代码修改。
