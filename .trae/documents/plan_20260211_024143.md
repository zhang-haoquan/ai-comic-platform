# 重构分镜表镜头编辑界面计划

根据您的需求，我将对 `shots/shot{id}` 界面进行深度重构，主要包含以下两个部分：

## 1. 修改类型定义
**文件**: `src/types/index.ts`
- 在 `Shot` 接口中新增 `videoPrompt` 字段，用于存储视频生成的提示词。

## 2. 重构 `ShotDetailView.vue`

**文件**: `src/views/storyboard/ShotDetailView.vue`

### 2.1 重构“图片生成模块”
- **组件结构**: 将原有的“提示词”卡片和“图片预览”卡片合并。
- **布局**:
  - **Header**: 标题“图片生成模块”。
  - **Upper Section**: 图片提示词区域。
    - 标题左对齐，14px，font-weight 500。
    - 多行文本域。
  - **Divider**: 1px 实线 `#E5E7EB`。
  - **Lower Section**: 图片预览区域。
    - **Grid**: 默认 3x3 (grid-cols-3)，间隙 8px。
    - **Responsive**: < 768px 时切换为 2x2 (grid-cols-2)，隐藏标题。
    - **Image**: `object-fit: cover`，固定宽高比或高度。
    - **Download**: 每个格子右上角悬浮下载按钮，点击模拟调用 `/api/shots/{id}/images/{index}/download`，带 loading 状态。

### 2.2 新增“分镜视频生成模块”
- **位置**: 位于图片生成模块下方，间距 24px。
- **结构**: 独立卡片。
- **Upper Section**: 视频提示词区域。
  - 标题“视频提示词”，14px，font-weight 500。
  - 文本域：高度 120px，4行，最大 512 字符，显示字符计数。
- **Lower Section**: 视频预览区域。
  - 16:9 比例，最小宽度 320px，黑色背景。
  - **State - No Video**: 显示占位图 + “生成视频”按钮。
    - 点击调用 POST `/api/shots/{id}/video/generate` (模拟)，轮询进度。
  - **State - Has Video**: 显示自定义视频播放器。
    - 包含：播放/暂停、进度条、音量、全屏。
    - **Download**: 控制栏最右侧下载按钮，调用 `/api/shots/{id}/video/download` (模拟)。

### 2.3 逻辑实现
- **State Management**:
  - 新增 `videoPrompt` ref。
  - 新增视频生成相关的 loading 状态 `generatingVideo`。
  - 新增图片下载 loading 状态 map。
- **Mock API**:
  - `downloadImage(index)`: 模拟 2s 延迟。
  - `generateVideo()`: 模拟请求和轮询，30s 内完成。
  - `downloadVideo()`: 模拟 5s 延迟。

我将按照此计划执行代码修改。
