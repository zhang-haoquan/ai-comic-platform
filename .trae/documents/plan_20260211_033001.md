# 分镜编辑界面修复与优化计划

根据您的需求，我将执行以下修改计划：

## 1. 布局调整：左右模块互换

**文件**: `src/views/storyboard/ShotDetailView.vue`

*   **当前布局**:
    *   左侧 (`div.space-y-6`): 图片生成模块、视频生成模块
    *   右侧 (`div.space-y-4`): 镜头信息模块、绑定资产模块
*   **目标布局**:
    *   左侧: 镜头信息模块、绑定资产模块
    *   右侧: 图片生成模块、视频生成模块
*   **实施方法**:
    *   将包含“镜头信息”和“绑定资产”的 `div.space-y-4` 移动到 grid 容器的第一个子元素位置。
    *   将包含“图片生成”和“视频生成”的 `div.space-y-6` 移动到 grid 容器的第二个子元素位置。

## 2. 图片生成按钮样式修改

**文件**: `src/views/storyboard/ShotDetailView.vue`

*   **当前样式**: 图标按钮 (旋转 90° 的 `VideoPause` 图标)。
    *   `<el-button ... style="transform: rotate(90deg); ..."><el-icon ...><VideoPause /></el-icon></el-button>`
*   **目标样式**: 文字按钮 "生成"，背景蓝色。
    *   移除内联样式 `transform`。
    *   设置 `type="primary"` (蓝色背景)。
    *   内容改为文本 "生成"，可选添加合适图标（如 `Picture` 或保持无图标）。
    *   保留 `loading` 状态和点击事件。

## 3. 流程可视化逻辑增强

**文件**: `src/views/storyboard/ShotDetailView.vue`

*   **当前逻辑**:
    *   `isStep1Completed` (computed): 依赖 `currentStep > 1` (仅通过 `saveShotBasicInfo` 成功后修改 `currentStep` 来判断)。
    *   `isStep2Completed` (computed): 依赖 `currentShot.images` 有图片 或 `currentStep > 2`。
*   **优化逻辑**:
    *   **步骤 1 (镜头信息)**: 必须点击“保存”按钮且接口返回成功后，才能激活步骤 2。
        *   维持现有 `saveShotBasicInfo` 中设置 `currentStep = 2` 的逻辑。
        *   确保步骤 2 的遮罩层条件 `currentStep < 2` 依然有效。
    *   **步骤 2 (分镜图片)**: 必须点击“生成”按钮且成功后，才能激活步骤 3。
        *   当前 `generateStoryboardImages` 已包含 `if (currentStep === 2) currentStep.value = 3` 的逻辑。
        *   确保步骤 3 的遮罩层条件 `currentStep < 3` 依然有效。
    *   **状态初始化**: `onMounted` 中根据数据初始化 `currentStep` 的逻辑可能需要调整，以确保严格遵循“点击过保存/生成”的约束。如果后端没有明确的“已保存”状态字段，我们可能需要依赖 `updatedAt` 或 `images` 数组来推断，或者严格要求本次会话中必须操作一次。根据需求描述 "当镜头信息没有点击保存按钮时...反之如果点击了...则激活"，这暗示了基于**操作行为**的激活，而非仅仅基于数据存在。
    *   **修正**: 确保 `currentStep` 的流转严格依赖于按钮点击事件的回调。

### 实施步骤
1.  **交换 DOM 结构**: 调整左右列顺序。
2.  **修改按钮**: 更新图片生成按钮的 props 和 slot content。
3.  **验证逻辑**: 检查 `saveShotBasicInfo` 和 `generateStoryboardImages` 中的状态流转代码，确保符合新的激活条件描述。

我将按照此计划执行代码修改。
